FROM ubuntu
EXPOSE 8080 8081

# Install dependencies
RUN apt-get update \
    && apt-get install -y git gcc vim \
    && apt-get install -y python python-pip python3-dev python3-pip \
    && apt-get install -y libssl-dev swig libffi-dev ssdeep libfuzzy-dev unrar p7zip-full \
    && apt-get install -y clamav-daemon clamav-freshclam \
    && freshclam \
    && /etc/init.d/clamav-daemon start \
    && pip install pyclamd \
    && pip install capstone

# Install pyew & cosa-nostra
RUN cd /opt \
    && git clone https://github.com/fenprace/cosa-nostra \
    # && cd cosa-nostra \
    # && cd /usr/local/lib/python2.7/dist-packages \
    && git clone https://github.com/joxeankoret/pyew

# Install viper
RUN cd /opt \
    && git clone https://github.com/viper-framework/viper \
    && cd viper \
    && git submodule init \
    && git submodule update \
    && pip3 install setuptools wheel --upgrade

RUN cd /opt/viper/ \
    && pip3 install pyopenssl==18.0.0 \
    # Fix wrong version of lief
    && cp requirements-modules.txt requirements-modules.tmp.txt \
    && head -n -1 requirements-modules.tmp.txt > requirements-modules.txt \
    && echo 'lief==0.9.0' >> requirements-modules.txt \
    && rm -rf requirements-modules.tmp.txt \
    && pip3 install .
