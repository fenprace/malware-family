import React, { useState, useEffect } from 'react'
import { List } from 'antd'
import { ClusterTags } from './Cluster'

const ClusterDescription = (props) => {
    const { cluster } = props
    return <div>
        {cluster.max_funcs && <div>Maximum function calls: {cluster.max_funcs}</div>}
        {cluster.min_funcs && <div>Minimum function calls: {cluster.min_funcs}</div>}

        {
            cluster.description && <div style={{
                overflow: 'hidden',
                textOverflow: 'ellipsis',
                whiteSpace: 'nowrap',
                maxWidth: '600px',
                
            }}>
                Contain Samples: {cluster.description.join(', ')}
            </div>
        }
    </div>
}

const Clusters = (props) => {
    const { onSelectCluster } = props

    const [clusters, setClusters] = useState(null)

    useEffect(() => {
        d3.json('./clusters.json').then(_clusters => {
            _clusters.forEach(item => {
                if (item.description) item.description = item.description.split('\n')
                if (item.tags) item.tags = JSON.parse(item.tags)
            })

            setClusters(_clusters)
        })
    }, [])

    return clusters && <List
        dataSource={clusters}
        renderItem={item => <List.Item onClick={() => onSelectCluster(item)}>
            <List.Item.Meta
                title={`Cluster ${item.id}`}
                description={<ClusterDescription cluster={item} />}
            />
            { item.tags && <ClusterTags items={item.tags} /> }
        </List.Item>}
    />
}

export default Clusters