import React from 'react';

import TreeGraph from './tree.js'
import TreeMapGraph from './treemap.js'

d3.csv('./MalwareFamilies.csv').then(samples => {
    const sourceData = [{ name: 'root', fullName: 'root', parent: '' }];

    samples = samples.filter(d => d.Family !== 'BaiXiang I')

    for (let i in samples) {
        if (i> 50) break

        const sample = samples[i]
        const [n0, n1, n2, n3] = sample.Name.split('.')

        if (!sourceData.find(d => d.fullName === n0)) {
            sourceData.push({ name: n0, fullName: n0, parent: 'root' });
        }

        if (!sourceData.find(d => d.fullName === `${n0}.${n1}`)) {
            sourceData.push({ name: n1, fullName: `${n0}.${n1}`, parent: n0 });
        }

        if (!sourceData.find(d => d.fullName === `${n0}.${n1}.${n2}`)) {
            sourceData.push({ name: n2, fullName: `${n0}.${n1}.${n2}`, parent: `${n0}.${n1}` });
        }

        sourceData.push({ name: n3, fullName: `${n0}.${n1}.${n2}.${n3}`, parent: `${n0}.${n1}.${n2}` })
    }

    const svg = d3.select('#canvas')
        const tree = new TreeGraph(svg, sourceData)
        const treeMap = new TreeMapGraph(svg, sourceData)
        tree.draw()

        const typeSelector = d3.select('select[name=type]')
        typeSelector.node().onchange = e => {
            svg.selectAll('*').remove()

            if (e.target.value === 'tree') {
                tree.draw()
            } else if (e.target.value === 'treemap') {
                treeMap.draw()
            }
        }
});
